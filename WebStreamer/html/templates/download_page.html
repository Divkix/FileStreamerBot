<!DOCTYPE html>

<html lang="en">
  <head>
    <title>FileStreamBot - Download Page</title>
    <script async src="https://arc.io/widget.min.js#iV2ngVtF"></script>
    <script
      async
      src="https://ackee.divkix.me/tracker.js"
      data-ackee-server="https://ackee.divkix.me"
      data-ackee-domain-id="76b6ce15-fbd8-4187-b822-ae4798fa38ed"
      data-ackee-opts='{ "detailed": true }'
    ></script>
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    <style>
      .btn {
        background-color: DodgerBlue;
        border: none;
        color: white;
        padding: 12px 30px;
        cursor: pointer;
        font-size: 20px;
      }
      button:disabled,
      button[disabled] {
        border: 1px solid #999999;
        background-color: #cccccc;
        color: #666666;
      }
    </style>
  </head>

  <body>
    <div
      class="h-captcha"
      data-sitekey="b349154f-f7b7-4752-bcfd-187cb50f4b75"
      data-callback="onSubmit"
    ></div>
    <button
      id="vBtn"
      class="btn"
      onclick="window.open('{{ download_link }}')"
      style="width: 100%"
      disabled="true"
    >
      <i class="fas fa-download"></i> Download
    </button>

    <script>
      function onSubmit(token) {
        const btn = document.getElementById("vBtn");
        btn.disabled = false;
        console.log("Response Token: ", token);
        sendPostReq(token);
      }

      function sendPostReq(rToken) {
        const url = "https://hcaptcha.com/siteverify";
        // const url = "https://httpbin.org/post";
        const jsonData = {
          response: rToken,
          secret: "0x622965962F316d443F7cc9B9AA2402f222becea9",
        };
        var options = {
          method: "POST",
          body: JSON.stringify(jsonData),
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
        };

        fetch(url, options)
          .then((data) => data.json())
          .then(function (data) {
            const success = data["success"];
            if (success) {
              console.log("Captcha Solve Success");
            } else {
              console.log("Captcha Solve Failed:\n", data);
            }
          })
          .catch((err) => console.error("Error: ", err));
      }
    </script>
  </body>
</html>
